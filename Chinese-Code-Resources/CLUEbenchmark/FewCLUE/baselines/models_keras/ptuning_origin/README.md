# ptuning的相关预测代码

## 环境要求：
1. export TF_KERAS=1  (需要使用tf作为后端)
1. bert4keras (0.10.5)
1. Keras (2.3.1)
1. tensorflow-gpu (1.14.0)
1. h5py 2.10
1. chinese_roberta_wwm_ext_L-12_H-768_A-12

h5py：如果h5py是高版本，需要卸载h5py再安装h5py:
pip install h5py==2.10 -i https://pypi.tuna.tsinghua.edu.cn/simple/

## 内容
1. p-tuning:    
   基于bert4keras复现原论文模型结构，并在robert（12层）的基础上，对9个任务进行测试

## todo
1. 优化部分任务的模版及其他参数
1. 测试非公开测试集数据


## 测试方式
```python
python ptuning_iflytek.py 0 # 运行iflytek任务，并使用第0个数据集
```
模型的验证集/训练集/batch size/max seq len/训练轮次/模版格式等，对结果都有影响，可根据具体自行设置。

## 结果
| 数据集   | score     | eprstmt  | bustm  | ocnli   | csldcp   | tnews | wsc | ifytek| csl | chid  |
| :----:| :----:  | :----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |:----: |
|0|0.611124444| 0.88525	| 0.59086	| 0.44405	| 0.57063	| 0.55277	| 0.60656	| 0.57791	| 0.67019	| 0.6019	| 
|1|0.604553333| 0.88197	| 0.6456	| 0.42659	| 0.56166	| 0.54158	| 0.60246	| 0.57599	| 0.62121	| 0.58392	| 
|2|0.593363333| 0.87049	| 0.61456	| 0.40556	| 0.54877	| 0.53038	| 0.5666	| 0.57216	| 0.62086	| 0.61089	| 
|3|0.591682222| 0.88689	| 0.62415	| 0.39603	| 0.54933	| 0.53412	| 0.57172	| 0.56577	| 0.62121	| 0.57592	| 
|4|0.595266667| 0.88852	| 0.57111	| 0.42262	| 0.57063	| 0.55277	| 0.5584	| 0.59004	| 0.6124	| 0.59091	| 
|few_all|0.650745556| 0.89836	| 0.65011	| 0.49603	| 0.63509	| 0.55917	| 0.6752	| 0.62261	| 0.70825	| 0.61189	| 
|avg|0.599198| 0.882624	| 0.609256	| 0.41897	| 0.560204	| 0.542324	| 0.581148	| 0.576374	| 0.629174	| 0.599198	| 
|std|-| 0.007202762	| 0.029001638	| 0.018751433	| 0.010822466	| 0.010353214	| 0.02189734	| 0.008936847	| 0.023236031	| 0.013940738	