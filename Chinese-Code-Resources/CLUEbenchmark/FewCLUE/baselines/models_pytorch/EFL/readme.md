# EFL相关代码

## 环境要求
1. python3
2. pytorch (1.7.0)
3. 预训练模型为chinese_roberta_wwm_ext_L-12_H-768_A-12


## 测试方式
```python
1. bash run_classifier_tnews.sh # tnews进行训练
2. bash run_classifier_tnews.sh predict # tnews进行预测
3. bash run_classifier_all # 对所有任务使用所有train和dev进行训练和预测
```
模型的验证集/训练集/batch size/max seq len/训练轮次/模版格式/learning rate等，对结果都有影响，可根据具体自行设置。

## 已有结果
| 模型           | score   | eprstmt | bustm  | ocnli   | csldcp  | tnews  | wsc   | iflytek| csl   | chid  |
| :----:         | :----:  | :----:  |:----:  |:----:   |:----:   |:----:  |:----: |:----:  |:----: |:----: |
| EFL wo PT (1)  |         |0.749    |0.606   |0.335    |0.253    |0.484   |0.511  |0.282   |0.504  |0.181  |
| EFL wo PT (2)  |         |--       |0.629   |0.334    |0.451    |0.530   |--     |0.403   |0.593  |  --   |
| EFL (3)        |         |0.849    |0.718   |0.662    |0.450    |0.521   |0.530  |0.427   |0.566  |0.309  |

1. 正负样本比例1:1
2. 正负样本比例1:8
   其中ocnli为三分类，构建了4倍的contradiction样本
   bustm构建了4倍的负例样本
   eprstmt/wsc/chid 负样本数量较少，没有进行1:8的构建
3. 采用已有的中文文本蕴含任务如cmnli或者ocnli对模型进行预先训练，再拿这个预先训练的模型作为预训练模型

## 多次实验具体结果
| 模型        | score     | eprstmt  | bustm  | ocnli   | csldcp   | tnews | wsc   | iflytek | csl   | chid  |
| :----:      | :----:    | :----:   |:----:  |:----:   |:----:    |:----: |:----: |:----:   |:----: |:----: |
| EFL wo PT(1)| train 0   |0.538     |0.602   |0.329    |0.291     |0.487  |0.501  |0.214    |0.508  |0.179  |
|             | train 1   |0.816     |0.613   |0.336    |0.365     |0.500  |0.544  |0.360    |0.501  |0.117  |
|             | train 2   |0.803     |0.608   |0.324    |0.099     |0.493  |0.517  |0.178    |0.502  |0.190  |
|             | train 3   |0.838     |0.627   |0.342    |0.203     |0.526  |0.490  |0.377    |0.504  |0.210  |
|             | train 4   |0.748     |0.579   |0.342    |0.309     |0.416  |0.504  |0.282    |0.505  |0.209  |
|             | train all |0.849     |0.653   |0.346    |0.222     |0.511  |0.558  |0.432    |0.521  |0.252  |
|             | train avg |0.749     |0.606   |0.335    |0.253     |0.484  |0.511  |0.282    |0.504  |0.181  |
|             | train std |0.109     |0.606   |0.007    |0.093     |0.037  |0.019  |0.078    |0.002  |0.034  |
| EFL wo PT(2)| train 0   |0.538     |0.637   |0.340    |0.443     |0.544  |0.501  |0.389    |0.616  |0.179  |
|             | train 1   |0.816     |0.646   |0.331    |0.437     |0.535  |0.544  |0.423    |0.652  |0.117  |
|             | train 2   |0.803     |0.592   |0.318    |0.467     |0.535  |0.517  |0.366    |0.591  |0.190  |
|             | train 3   |0.838     |0.641   |0.335    |0.463     |0.514  |0.491  |0.407    |0.500  |0.210  |
|             | train 4   |0.748     |0.628   |0.344    |0.445     |0.520  |0.504  |0.428    |0.605  |0.209  |
|             | train all |0.849     |0.689   |0.344    |0.483     |0.539  |0.558  |0.524    |0.620  |0.252  |
|             | train avg |0.749     |0.629   |0.334    |0.451     |0.530  |0.511  |0.403    |0.593  |0.181  |
|             | train std |0.109     |0.019   |0.009    |0.012     |0.011  |0.018  |0.023    |0.051  |0.034  |
|EFL(3)(cmnli)| train 0   |0.790     |0.688   |0.665    |0.486     |0.505  |0.492  |0.419    |0.587  |0.205  |
|             | train 1   |0.848     |0.706   |0.658    |0.345     |0.500  |0.477  |0.447    |0.555  |0.275  |
|             | train 2   |0.833     |0.671   |0.637    |0.437     |0.538  |0.524  |0.427    |0.570  |0.263  |
|             | train 3   |0.831     |0.705   |0.676    |0.456     |0.508  |0.525  |0.425    |0.545  |0.217  |
|             | train 4   |0.795     |0.673   |0.673    |0.405     |0.523  |0.470  |0.412    |0.556  |0.249  |
|             | train all |0.861     |0.723   |0.696    |0.424     |0.544  |0.556  |0.520    |0.629  |0.356  |
|             | train avg |0.819     |0.689   |0.662    |0.426     |0.515  |0.498  |0.426    |0.563  |0.242  |
|             | train std |0.023     |0.015   |0.014    |0.048     |0.014  |0.023  |0.012    |0.015  |0.027  |
|EFL(3)(ocnli)| train 0   |0.849     |0.722   |0.667    |0.453     |0.525  |0.525  |0.419    |0.579  |0.302  |
|             | train 1   |0.848     |0.720   |0.665    |0.470     |0.525  |0.544  |0.447    |0.545  |0.306  |
|             | train 2   |0.843     |0.710   |0.640    |0.471     |0.530  |0.579  |0.427    |0.573  |0.318  |
|             | train 3   |0.851     |0.730   |0.684    |0.448     |0.508  |0.514  |0.425    |0.545  |0.280  |
|             | train 4   |0.856     |0.707   |0.656    |0.408     |0.517  |0.487  |0.416    |0.588  |0.337  |
|             | train all |0.838     |0.736   |0.669    |0.452     |0.544  |0.636  |0.529    |0.666  |0.398  |
|             | train avg |0.849     |0.718   |0.662    |0.450     |0.521  |0.530  |0.427    |0.566  |0.309  |
|             | train std |0.004     |0.008   |0.014    |0.023     |0.008  |0.031  |0.011    |0.018  |0.019  |

### 备注
1. 模版对效果影响挺大
2. cmnli和ocnli的预先训练模型为分别使用 
    https://github.com/CLUEbenchmark/CLUE/blob/master/baselines/models_pytorch/classifier_pytorch/run_classifier_cmnli.sh
    https://github.com/CLUEbenchmark/CLUE/blob/master/baselines/models_pytorch/classifier_pytorch/run_classifier_ocnli.sh
    进行训练的模型
3. train all :train_few_all.json测试结果
    train avg : train_0-4 的平均值
    train std : train_0-4 的标准差
4. 所有测试结果都为test_public.json上效果
